<div class="container">
  <!-- Affichage du message d'erreur -->
  <div *ngIf="errorMessage" class="error-message">
    <p>{{ errorMessage }}</p>
  </div>

  <div *ngIf="emailExists">
    <p>Cet email est déjà associé à un compte. <a (click)="navigateToLogin()">Connectez-vous ici</a>.</p>
  </div>

  <!-- Étape 1: Email -->
  <div *ngIf="!emailSent && !emailVerified && !emailExists">
    <form #form="ngForm" (ngSubmit)="sendVerificationEmail(form)">
      <div class="input-group">
        <label for="email">Email</label>
        <input
          type="email"
          id="email"
          [(ngModel)]="formData.email"
          name="email"
          placeholder="exemple@domaine.com"
          required
          #email="ngModel"
        />
         <!-- Ajout d'une variable locale pour l'accès à l'état de l'input -->
        <!-- Message d'erreur sous l'input email -->
        <div *ngIf="email.invalid && email.touched" class="error-message">
          <p *ngIf="email.errors?.['required']">L'email est requis.</p>
          <p *ngIf="email.errors?.['email']">Veuillez entrer un email valide.</p>
        </div>
      </div>
      <button type="submit" class="submit-btn">Envoyer le code de vérification</button>
    </form>
  </div>

  <!-- Étape 2: Vérification du code -->
  <div *ngIf="emailSent && !emailVerified" class="email-verification">
    <h2>Vérification email</h2>
    <p class="info">Nous vous avons envoyé un code de vérification sur <span>{{ formData.email }}</span></p>
    <form #form="ngForm" (ngSubmit)="verifyCode(form)">
      <div class="input-group">
        <input
          type="text"
          id="verificationCode"
          [(ngModel)]="verificationCode"
          name="verificationCode"
          placeholder="Entrez votre code de vérification"
          required
          #verificationCodeInput="ngModel"
        />
        <!-- Message d'erreur sous le champ de code de vérification -->
        <div *ngIf="verificationCodeInput.invalid && verificationCodeInput.touched" class="error-message">
          <p *ngIf="verificationCodeInput.errors?.['required']">Le code de vérification est requis.</p>
        </div>
      </div>

      <!-- Compte à rebours -->
      <p class="countdown">Temps restant : <span>{{ countdownMinutes }} : {{ countdownSeconds }} </span></p>

      <button type="submit" class="submit-btn">Vérifier le code</button>
    </form>
  </div>

  <!-- Étape 3: Nom, Téléphone, Rôle, Photo de profil -->
  <div *ngIf="emailVerified && !additionalInfoProvided">
    <h1>Inscription</h1>

    <form #form="ngForm" (ngSubmit)="submitAdditionalInfo(form)">
      <div class="input-group">
        <label for="name">Nom</label>
        <input
          type="text"
          id="name"
          [(ngModel)]="formData.name"
          name="name"
          placeholder="Votre nom complet"
          required
          #name="ngModel"
        />
        <!-- Message d'erreur sous le champ nom -->
        <div *ngIf="name.invalid && name.touched" class="error-message">
          <p *ngIf="name.errors?.['required']">Le nom est requis.</p>
        </div>
      </div>

      <div class="input-group">
        <label for="phone">Téléphone</label>
        <input
          type="tel"
          id="phone"
          [(ngModel)]="formData.phone"
          name="phone"
          placeholder="Numéro de téléphone"
          required
          #phone="ngModel"
        />
        <!-- Message d'erreur sous le champ téléphone -->
        <div *ngIf="phone.invalid && phone.touched" class="error-message">
          <p *ngIf="phone.errors?.['required']">Le numéro de téléphone est requis.</p>
        </div>
      </div>

      <div class="input-group">
        <label for="role">Rôle</label>
        <select
          id="role"
          [(ngModel)]="formData.role"
          name="role"
          required
          #role="ngModel"
        >
          <option value="organizer">Organisateur</option>
          <option value="participant">Participant</option>
        </select>
        <!-- Message d'erreur sous le champ rôle -->
        <div *ngIf="role.invalid && role.touched" class="error-message">
          <p *ngIf="role.errors?.['required']">Le rôle est requis.</p>
        </div>
      </div>

      <div class="input-group">
        <label for="photo">Photo de profil (URL)</label>
        <input type="url" id="photo" [(ngModel)]="formData.photo" name="photo" placeholder="Lien vers votre photo de profil"  #photo="ngModel"/>
        <!-- Message d'erreur sous le champ photo de profil -->
        <div *ngIf="photo.invalid && photo.touched" class="error-message">
          <p *ngIf="photo.errors?.['required']">L'URL de la photo est requise.</p>
          <p *ngIf="photo.errors?.['url']">Veuillez entrer une URL valide.</p>
        </div>
      </div>

      <button type="submit" class="submit-btn">Soumettre les informations</button>
    </form>
  </div>

  <!-- Étape 4: Mot de passe -->
  <div *ngIf="additionalInfoProvided">
    <h1>Définir un mot de passe</h1>

    <form #form="ngForm" (ngSubmit)="register(form)">
      <div class="input-group">
        <label for="password">Mot de passe</label>
        <input
          type="password"
          id="password"
          [(ngModel)]="formData.password"
          name="password"
          placeholder="Mot de passe"
          required
          minlength="6"
          #password="ngModel"
        />
        <!-- Message d'erreur sous le champ mot de passe -->
        <div *ngIf="password.invalid && password.touched" class="error-message">
          <p *ngIf="password.errors?.['required']">Le mot de passe est requis.</p>
          <p *ngIf="password.errors?.['minlength']">Le mot de passe doit contenir au moins 6 caractères.</p>
        </div>
      </div>

      <div class="input-group">
        <label for="password_confirmation">Confirmer le mot de passe</label>
        <input
          type="password"
          id="password_confirmation"
          [(ngModel)]="formData.password_confirmation"
          name="password_confirmation"
          placeholder="Confirmez le mot de passe"
          required
          #passwordConfirmation="ngModel"
        />
        <!-- Message d'erreur sous le champ confirmation du mot de passe -->
        <div *ngIf="passwordConfirmation.invalid && passwordConfirmation.touched" class="error-message">
          <p *ngIf="passwordConfirmation.errors?.['required']">La confirmation du mot de passe est requise.</p>
          <p *ngIf="formData.password !== formData.password_confirmation">Les mots de passe ne correspondent pas.</p>
        </div>
      </div>

      <button type="submit" class="submit-btn">S'inscrire</button>
    </form>
  </div>
</div>
